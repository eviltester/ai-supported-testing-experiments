<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Learn a Topic using AI Answered Questions</title>
    <description>An experiment in learning using AI</description>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 0 20px;
            line-height: 1.6;
        }
        h1 {
            color: #333;
        }
        ol {
            counter-reset: item;
        }
        ol > li {
            margin: 15px 0;
        }
        ol ol {
            list-style-type: none;
            padding-left: 20px;
        }
        ol ol li {
            margin: 5px 0;
        }
        a {
            color: #0066cc;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1 id="topicHeading" data-topicname="topicX">Choose a Topic for Questions</h1>
    <p><button onclick="setTopic()">Choose Topic</button><span id="shareableLink"></span></p>

    <script>
        grokConversationId = "";
    </script>

    <details> <!-- Initial status: closed -->
        <summary>Existing Conversations</summary>
        <div style="background-color: #d6fbfb;">
            <p>By default the links open a new conversation each time.</p>
            <p>Some of the LLMs support conversations through the query interface.</p>
            <p>Enter a conversation id below and click [Use Conversation]</p>
            <ul>
                <li>
                    <label for="grokConversationId">GROK : Enter the id shown in the x.com/i/grok url i.e. ?conversation=</label>
                    <input id="grokConversationId"></input>
                    <button id="useGrokConversationId" onclick="setGrokConversationId()">Use Conversation</button>
                </li>
            </ul>
        </div>
    </details>
    
    <ol id="questionList">
        <li>What is topicX?</li>
    </ol>

    <div style="margin-top: 30px;">
        <label for="moreQuestions" style="display: block; margin-bottom: 10px; font-weight: bold;">More Questions?</label>
        <p id="generateMoreQuestions"></p>
        <textarea id="moreQuestions" rows="5" style="width: 100%; padding: 10px; font-family: Arial, sans-serif; font-size: 14px; border: 1px solid #ccc; border-radius: 4px;"></textarea>
        <button id="addQuestionsBtn" style="margin-top: 10px; padding: 10px 20px; background-color: #0066cc; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;" onclick="addNewQuestions()">Add These Questions</button>
    </div>

    <script>

        function setGrokConversationId(){
            const inputField = document.getElementById("grokConversationId");
            if(inputField){
                const fieldValue = inputField.value;
                if(fieldValue && fieldValue!=""){
                    grokConversationId=fieldValue;
                    amendExistingGrokLinksToUseConversation(grokConversationId);
                    alert("Grok configured with conversation id = " + grokConversationId);
                }
            }
        }

        function setTopic(){
            const topic = prompt('Ask Questions about topic:');
            if(topic != null){
                addTopic(topic);
            }
        }

        function addTopic(topicName){
            const questions = [
                "What is topicX?",
                "Why is topicX important/useful?",
                "Why do we use topicX?",
                "When/where is topicX used?",
                "How does topicX work?",
                "What are the key principles/concepts of topicX?",
                "What are common examples of topicX?",
                "What are the main benefits of topicX?",
                "What are the main drawbacks of topicX?",
                "How does topicX differ from similar approaches?",
                "What skills are needed to do topicX?",
                "What tools are used for topicX?",
                "What are common mistakes or challenges with topicX?",
                "What syllabus would I follow to learn topicX?",
                "What exercises would I do to gain proficiency with topicX?"
            ]

            const ol = document.getElementById('questionList');
            ol.innerHTML = '';

            questions.forEach(question => {
                const nestedLi = document.createElement('li');
                var text = document.createTextNode(question.replace("topicX", topicName));
                nestedLi.appendChild(text);
                ol.appendChild(nestedLi)
            })

            addSearchLinks();

            const h1 = document.getElementById('topicHeading');
            h1.textContent = topicName + " Questions";
            h1.dataset.topicname = topicName;

            const generateMoreQuestions = "What questions should i ask an expert to learn about " + topicName + "? Provide the list of questions as a single block of text with each question on a new line with no formatting.";
            const moreQuestions = document.getElementById('generateMoreQuestions');
            moreQuestions.innerHTML = '';
            addQuestionSearchLinks(moreQuestions, generateMoreQuestions);

            const share = document.getElementById('shareableLink');
            share.innerHTML = '';
            var shareableLinkText = document.createTextNode(" Shareable Link: ");
            const shareableLink = document.createElement('a');
            shareableLink.href = window.location.origin + window.location.pathname + "?q=" + encodeURIComponent(topicName);
            shareableLink.textContent=topicName;
            share.appendChild(shareableLinkText);
            share.appendChild(shareableLink);

        }

        function addSearchLinks() {
            const ol = document.getElementById('questionList');
            const items = ol.querySelectorAll(':scope > li');
            
            items.forEach(item => {

                // Skip if already has a nested list
                if (item.querySelector('ol')) return;

                const question = item.textContent.trim();
                
                
                const nestedOl = document.createElement('ol');
                const nestedLi = document.createElement('li');

                addQuestionSearchLinks(nestedLi, question);

                nestedOl.appendChild(nestedLi);
                item.appendChild(nestedOl);
            });
        }

        function amendExistingGrokLinksToUseConversation(aGrokConversationId){
            const ol = document.getElementById('questionList');
            const items = ol.querySelectorAll(':scope > li a');
            
            items.forEach(link => {
                try {
                    const href = link.getAttribute('href');
                    
                    // Skip if href is empty, a hash only, or javascript:
                    if (!href || href.startsWith('#') || href.startsWith('javascript:')) {
                        return;
                    }

                    // only process grok links
                    if(!href.includes("x.com/i/grok")){
                        return;
                    }
                    
                    // Create URL object to properly parse and modify the URL
                    let url = new URL(href);
                                        
                    // Add or update the conversation parameter
                    url.searchParams.set('conversation', aGrokConversationId);
                    
                    // Update the link's href
                    link.setAttribute('href', url.toString());
                    
                } catch (error) {
                    console.warn('Could not process link:', link.href, error);
                }
            });
        }

        function addQuestionSearchLinks(parentElement, question){

            const encodedQuestion = encodeURIComponent(question);

            let grokUrl = "https://x.com/i/grok?text=";
            if(grokConversationId && grokConversationId!=""){
                grokUrl = "https://x.com/i/grok?conversation=" + grokConversationId + "&text="
            }

            const searchUrls = [
                ["openai", "https://chat.openai.com/?q="],
                ["perplexity", "https://www.perplexity.ai/search/new?q="],
               //["claude", "https://claude.ai/new?q="],
                ["grok", grokUrl],
                ["google ai", "https://www.google.com/search?udm=50&aep=11&q="],
                ["bing", "https://www.bing.com/chat?sendquery=1&q="]
            ]

            // search urls with existing conversation ids add conversation=id into the param list e.g.
            // https://x.com/i/grok?conversation=12345&text=
            // openai ? not sure supports this via GET
            // perplexity ? don't think it supports this via GET
            // bing? does not seem to support it



            searchUrls.forEach(search => {
                const searchUrl = `${search[1]}${encodedQuestion}`;
                const link = document.createElement('a');
                
                link.href = searchUrl;
                link.textContent = `[${search[0]}] `;
                link.target = '_blank';
                
                parentElement.appendChild(link);
            })
        }
        
        function addNewQuestions() {
            const textarea = document.getElementById('moreQuestions');
            const ol = document.getElementById('questionList');
            const lines = textarea.value.split('\n');
            
            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine) {
                    const li = document.createElement('li');
                    li.textContent = trimmedLine;
                    ol.appendChild(li);
                }
            });
            
            // Clear the textarea
            textarea.value = '';
            
            // Add search links to the new questions
            addSearchLinks();
        }

        

        // Run the function when the page loads
        const givenTopicAsQ_param = new URL(window.location.href).searchParams.get("q");
        if(givenTopicAsQ_param!=null){
            const topic = decodeURIComponent(givenTopicAsQ_param);
            addTopic(topic);
        }

    </script>
</body>
</html>